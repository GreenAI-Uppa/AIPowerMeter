<!DOCTYPE html>
<html>
<head>
  <title>My first Vue app</title>
  <script src="https://unpkg.com/vue"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script type = "text/javascript" src = "https://d3js.org/d3.v4.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900|Material+Icons" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/quasar@2.0.1/dist/quasar.prod.css" rel="stylesheet" type="text/css">      <style>
         .line {
            fill: none;
            stroke: green;
            stroke-width: 5px;
         }
      </style>
</head>
<body>
	<div id="q-app">
    <q-layout view="hHh lpR fFf">
      <q-header elevated class="bg-primary text-white" height-hint="98">
        <q-toolbar>
          <q-btn dense flat round icon="menu" @click="left = !left" />
          <q-toolbar-title>
            <q-avatar>
              <img src="https://cdn.quasar.dev/logo/svg/quasar-logo.svg">
            </q-avatar>
            Title
          </q-toolbar-title>
        </q-toolbar>

        <q-tabs align="left">
          <q-route-tab to="/page1" label="Page One" />
          <q-route-tab to="/page2" label="Page Two" />
        </q-tabs>
      </q-header>

      <q-drawer show-if-above v-model="left" side="left" bordered>
        <div class="q-pa-md">
        <q-table
          title="Model card"
          :rows="rows"
          :columns="columns"
          row-key="name"
          />
        </div>
      </q-drawer>

      <q-page-container>
        <svg width="500" height="500" id="curve_top"></svg>
        <svg width="500" height="500" id="curve_bottom"></svg>
        <router-view />
      </q-page-container>
    </q-layout>

  </div>
  <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/quasar@2.0.1/dist/quasar.umd.prod.js"></script>

    <script>
    app_code = {
        delimiters:['${', '}'],
        async mounted(){
          this.init();
        },
        data() {
          return {
            left : true, // whether or not display the left drawer
            curve_acc : [],
            curve_power : [],
            columns: [
              { name: 'feature', required: true, label: 'Feature', align: 'left', field: row => row.name, format: val => `${val}`, sortable: true},
              { name: 'Value', align: 'center', label: 'Value', field: 'value', sortable: true }
            ],
            rows: [
              { name: 'Input Size', id : 'input_size', value: 0 },
              { name: 'Total Params', id : 'total_params', value : 0},
              { name: 'Trainable Params', id : 'trainable_params', value: 0 },
              { name: 'Output Size', id: 'total_output', value: 0  },
              { name: 'Mult add ops',  id: 'total_mult_adds', value: 0}
            ]
          }
        },
        methods: {
          init() {
            const path = 'http://localhost:5001/get_models';
            this.init_model_card(path)
            this.set_curve()
          },
          init_model_card(model_card_url){
            axios.get(model_card_url)
              .then((res) => {
                for(var i=0;i<this.rows.length; i++){
                  this.rows[i].value = res.data[this.rows[i].id]

                }
              })
              .catch((error) => {
                console.error(error);
              });
          },
          set_curve(){
            _this = this
            d3.json("http://localhost:5001/get_curves", function(error, data) {
               if (error) throw error;
               svg_id = "#curve_top"
               console.log(data)
               _this.draw_curve(data.accuracy, svg_id)

               svg_id = "#curve_bottom"
               _this.draw_curve(data.power_nvidia, svg_id)
            });
          },
          draw_curve(data, svg_id){
              var margin = {top: 20, right: 20, bottom: 30, left: 50},
              width = 960 - margin.left - margin.right,
              height = 200 - margin.top - margin.bottom;

              // set the ranges
              var x = d3.scaleTime().range([0, width]);
              var y = d3.scaleLinear().range([height, 0]);

              // define the line
              var valueline = d3.line()
                 .x(function(d) { return x(d.date); })
                 .y(function(d) { return y(d.value); });

              // append the svg obgect to the body of the page
              // appends a 'group' element to 'svg'
              // moves the 'group' element to the top left margin
              var svg = d3.select(svg_id)
                 .attr("width", width + margin.left + margin.right)
                 .attr("height", height + margin.top + margin.bottom)
                 .append("g").attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

              // Scale the range of the data
              x.domain(d3.extent(data, function(d) { return d.date; }));
              y.domain([0, d3.max(data, function(d) { return d.value; })]);

              // Add the valueline path.
              svg.append("path")
                 .data([data])
                 .attr("class", "line")
                 .attr("d", valueline);

              // Add the X Axis
              svg.append("g")
                 .attr("transform", "translate(0," + height + ")")
                 .call(d3.axisBottom(x));

              // Add the Y Axis
              svg.append("g")
                 .call(d3.axisLeft(y));
          }
        }, // end of methods
      } // end of new Vue

      const app = Vue.createApp(app_code)
      app.use(Quasar)
      app.mount('#q-app')
</script>
</body>
</html>
